{"id":"../../../node_modules/graphql-tools/dist/stitching/makeRemoteExecutableSchema.js","dependencies":[{"name":"/Users/yanivsilberman/Desktop/projects/legaycafe/node_modules/graphql-tools/dist/stitching/makeRemoteExecutableSchema.js.map","includedInParent":true,"mtime":499162500000},{"name":"/Users/yanivsilberman/Desktop/projects/legaycafe/package.json","includedInParent":true,"mtime":1559527591184},{"name":"/Users/yanivsilberman/Desktop/projects/legaycafe/node_modules/graphql-tools/package.json","includedInParent":true,"mtime":1559527589425},{"name":"graphql","loc":{"line":37,"column":24},"parent":"/Users/yanivsilberman/Desktop/projects/legaycafe/node_modules/graphql-tools/dist/stitching/makeRemoteExecutableSchema.js","resolved":"/Users/yanivsilberman/Desktop/projects/legaycafe/node_modules/graphql/index.mjs"},{"name":"./linkToFetcher","loc":{"line":38,"column":30},"parent":"/Users/yanivsilberman/Desktop/projects/legaycafe/node_modules/graphql-tools/dist/stitching/makeRemoteExecutableSchema.js","resolved":"/Users/yanivsilberman/Desktop/projects/legaycafe/node_modules/graphql-tools/dist/stitching/linkToFetcher.js"},{"name":"../isEmptyObject","loc":{"line":39,"column":30},"parent":"/Users/yanivsilberman/Desktop/projects/legaycafe/node_modules/graphql-tools/dist/stitching/makeRemoteExecutableSchema.js","resolved":"/Users/yanivsilberman/Desktop/projects/legaycafe/node_modules/graphql-tools/dist/isEmptyObject.js"},{"name":"../makeExecutableSchema","loc":{"line":40,"column":37},"parent":"/Users/yanivsilberman/Desktop/projects/legaycafe/node_modules/graphql-tools/dist/stitching/makeRemoteExecutableSchema.js","resolved":"/Users/yanivsilberman/Desktop/projects/legaycafe/node_modules/graphql-tools/dist/makeExecutableSchema.js"},{"name":"./schemaRecreation","loc":{"line":41,"column":33},"parent":"/Users/yanivsilberman/Desktop/projects/legaycafe/node_modules/graphql-tools/dist/stitching/makeRemoteExecutableSchema.js","resolved":"/Users/yanivsilberman/Desktop/projects/legaycafe/node_modules/graphql-tools/dist/stitching/schemaRecreation.js"},{"name":"./resolveFromParentTypename","loc":{"line":42,"column":42},"parent":"/Users/yanivsilberman/Desktop/projects/legaycafe/node_modules/graphql-tools/dist/stitching/makeRemoteExecutableSchema.js","resolved":"/Users/yanivsilberman/Desktop/projects/legaycafe/node_modules/graphql-tools/dist/stitching/resolveFromParentTypename.js"},{"name":"./defaultMergedResolver","loc":{"line":43,"column":38},"parent":"/Users/yanivsilberman/Desktop/projects/legaycafe/node_modules/graphql-tools/dist/stitching/makeRemoteExecutableSchema.js","resolved":"/Users/yanivsilberman/Desktop/projects/legaycafe/node_modules/graphql-tools/dist/stitching/defaultMergedResolver.js"},{"name":"./errors","loc":{"line":44,"column":23},"parent":"/Users/yanivsilberman/Desktop/projects/legaycafe/node_modules/graphql-tools/dist/stitching/makeRemoteExecutableSchema.js","resolved":"/Users/yanivsilberman/Desktop/projects/legaycafe/node_modules/graphql-tools/dist/stitching/errors.js"},{"name":"./observableToAsyncIterable","loc":{"line":45,"column":42},"parent":"/Users/yanivsilberman/Desktop/projects/legaycafe/node_modules/graphql-tools/dist/stitching/makeRemoteExecutableSchema.js","resolved":"/Users/yanivsilberman/Desktop/projects/legaycafe/node_modules/graphql-tools/dist/stitching/observableToAsyncIterable.js"}],"generated":{"js":"var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar graphql_1 = require(\"graphql\");\nvar linkToFetcher_1 = require(\"./linkToFetcher\");\nvar isEmptyObject_1 = require(\"../isEmptyObject\");\nvar makeExecutableSchema_1 = require(\"../makeExecutableSchema\");\nvar schemaRecreation_1 = require(\"./schemaRecreation\");\nvar resolveFromParentTypename_1 = require(\"./resolveFromParentTypename\");\nvar defaultMergedResolver_1 = require(\"./defaultMergedResolver\");\nvar errors_1 = require(\"./errors\");\nvar observableToAsyncIterable_1 = require(\"./observableToAsyncIterable\");\nfunction makeRemoteExecutableSchema(_a) {\n    var schema = _a.schema, link = _a.link, fetcher = _a.fetcher, _b = _a.createResolver, customCreateResolver = _b === void 0 ? createResolver : _b;\n    var _c;\n    if (!fetcher && link) {\n        fetcher = linkToFetcher_1.default(link);\n    }\n    var typeDefs;\n    var printOptions = { commentDescriptions: true };\n    if (typeof schema === 'string') {\n        typeDefs = schema;\n        schema = graphql_1.buildSchema(typeDefs);\n    }\n    else {\n        // TODO fix types https://github.com/apollographql/graphql-tools/issues/542\n        typeDefs = graphql_1.printSchema(schema, printOptions);\n    }\n    // prepare query resolvers\n    var queryResolvers = {};\n    var queryType = schema.getQueryType();\n    var queries = queryType.getFields();\n    Object.keys(queries).forEach(function (key) {\n        queryResolvers[key] = customCreateResolver(fetcher);\n    });\n    // prepare mutation resolvers\n    var mutationResolvers = {};\n    var mutationType = schema.getMutationType();\n    if (mutationType) {\n        var mutations = mutationType.getFields();\n        Object.keys(mutations).forEach(function (key) {\n            mutationResolvers[key] = customCreateResolver(fetcher);\n        });\n    }\n    // prepare subscription resolvers\n    var subscriptionResolvers = {};\n    var subscriptionType = schema.getSubscriptionType();\n    if (subscriptionType) {\n        var subscriptions = subscriptionType.getFields();\n        Object.keys(subscriptions).forEach(function (key) {\n            subscriptionResolvers[key] = {\n                subscribe: createSubscriptionResolver(key, link),\n            };\n        });\n    }\n    // merge resolvers into resolver map\n    var resolvers = (_c = {}, _c[queryType.name] = queryResolvers, _c);\n    if (!isEmptyObject_1.default(mutationResolvers)) {\n        resolvers[mutationType.name] = mutationResolvers;\n    }\n    if (!isEmptyObject_1.default(subscriptionResolvers)) {\n        resolvers[subscriptionType.name] = subscriptionResolvers;\n    }\n    // add missing abstract resolvers (scalar, unions, interfaces)\n    var typeMap = schema.getTypeMap();\n    var types = Object.keys(typeMap).map(function (name) { return typeMap[name]; });\n    var _loop_1 = function (type) {\n        if (type instanceof graphql_1.GraphQLInterfaceType ||\n            type instanceof graphql_1.GraphQLUnionType) {\n            resolvers[type.name] = {\n                __resolveType: function (parent, context, info) {\n                    return resolveFromParentTypename_1.default(parent, info.schema);\n                },\n            };\n        }\n        else if (type instanceof graphql_1.GraphQLScalarType) {\n            if (!(type === graphql_1.GraphQLID ||\n                type === graphql_1.GraphQLString ||\n                type === graphql_1.GraphQLFloat ||\n                type === graphql_1.GraphQLBoolean ||\n                type === graphql_1.GraphQLInt)) {\n                resolvers[type.name] = schemaRecreation_1.recreateType(type, function (name) { return null; }, false);\n            }\n        }\n        else if (type instanceof graphql_1.GraphQLObjectType &&\n            type.name.slice(0, 2) !== '__' &&\n            type !== queryType &&\n            type !== mutationType &&\n            type !== subscriptionType) {\n            var resolver_1 = {};\n            Object.keys(type.getFields()).forEach(function (field) {\n                resolver_1[field] = defaultMergedResolver_1.default;\n            });\n            resolvers[type.name] = resolver_1;\n        }\n    };\n    for (var _i = 0, types_1 = types; _i < types_1.length; _i++) {\n        var type = types_1[_i];\n        _loop_1(type);\n    }\n    return makeExecutableSchema_1.makeExecutableSchema({\n        typeDefs: typeDefs,\n        resolvers: resolvers,\n    });\n}\nexports.default = makeRemoteExecutableSchema;\nfunction createResolver(fetcher) {\n    var _this = this;\n    return function (root, args, context, info) { return __awaiter(_this, void 0, void 0, function () {\n        var fragments, document, result;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    fragments = Object.keys(info.fragments).map(function (fragment) { return info.fragments[fragment]; });\n                    document = {\n                        kind: graphql_1.Kind.DOCUMENT,\n                        definitions: [info.operation].concat(fragments),\n                    };\n                    return [4 /*yield*/, fetcher({\n                            query: document,\n                            variables: info.variableValues,\n                            context: { graphqlContext: context },\n                        })];\n                case 1:\n                    result = _a.sent();\n                    return [2 /*return*/, errors_1.checkResultAndHandleErrors(result, info)];\n            }\n        });\n    }); };\n}\nexports.createResolver = createResolver;\nfunction createSubscriptionResolver(name, link) {\n    return function (root, args, context, info) {\n        var fragments = Object.keys(info.fragments).map(function (fragment) { return info.fragments[fragment]; });\n        var document = {\n            kind: graphql_1.Kind.DOCUMENT,\n            definitions: [info.operation].concat(fragments),\n        };\n        var operation = {\n            query: document,\n            variables: info.variableValues,\n            context: { graphqlContext: context },\n        };\n        var observable = linkToFetcher_1.execute(link, operation);\n        return observableToAsyncIterable_1.observableToAsyncIterable(observable);\n    };\n}\n"},"sourceMaps":{"js":{"version":3,"file":"makeRemoteExecutableSchema.js","sourceRoot":"","sources":["../../src/stitching/makeRemoteExecutableSchema.ts"],"names":[],"mappings":"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","sourcesContent":[null]}},"error":null,"hash":"2b22904fd18afffee9707091123c56d3","cacheData":{"env":{}}}